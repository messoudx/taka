<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ â€” Ø£Ù„Ø¹Ø§Ø¨ Ø¨Ø³ÙŠØ·Ø©</title>
  <style>
    body{font-family:system-ui,Arial;direction:rtl;padding:20px;background:#0f172a;color:#e6eef8}
    .card{background:#0b1220;padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,.6);margin-bottom:18px}
    h1{font-size:20px;margin:0 0 12px}
    .nav{display:flex;gap:8px;margin-bottom:12px}
    button{cursor:pointer;padding:8px 12px;border-radius:8px;border:0;background:#2563eb;color:white}
    input{padding:8px;border-radius:8px;border:1px solid #233042;background:#081020;color:#e6eef8}
    /* TicTacToe grid */
    .grid{display:grid;grid-template-columns:repeat(3,80px);gap:8px;margin-top:12px}
    .cell{width:80px;height:80px;display:flex;align-items:center;justify-content:center;background:#071127;border-radius:10px;font-size:32px;user-select:none}
    .small{font-size:14px}
    /* memory */
    .memory-board{display:grid;grid-template-columns:repeat(4,70px);gap:8px}
    .tile{width:70px;height:70px;display:flex;align-items:center;justify-content:center;background:#081827;border-radius:8px;font-weight:bold;font-size:22px;cursor:pointer}
    .hidden{background:#072033}
  </style>
</head>
<body>
  <div class="card">
    <h1>ÙØ¹Ø§Ù„ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© Ù„Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ â€” Ø£Ù„Ø¹Ø§Ø¨ Ø°Ù‡Ù†ÙŠØ©</h1>
    <div class="small">Ø§Ø®ØªØ± Ù„Ø¹Ø¨Ø©: Ø§Ù„Ø¹Ø¨ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø£Ùˆ Ø§Ø¯Ø¹Ù ØµØ¯ÙŠÙ‚ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†ÙØ³ Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ© Ù„Ù„Ø¹Ø¨ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†.</div>
    <div class="nav">
      <button id="show-memory">Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© (Ù…Ø­Ù„ÙŠ)</button>
      <button id="show-tic">ØªÙŠÙƒ-ØªØ§Ùƒ-ØªÙˆ (Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†)</button>
    </div>
  </div>

  <!-- Memory (local) -->
  <div id="memory" class="card" style="display:none">
    <h2>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©</h2>
    <div class="small">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ù…Ø±Ø¨Ø¹ÙŠÙ† Ù„ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø±Ù…ÙˆØ².</div>
    <div id="memoryBoard" class="memory-board" style="margin-top:12px"></div>
    <div style="margin-top:10px"><button id="resetMemory">Ø¥Ø¹Ø§Ø¯Ø©</button></div>
  </div>

  <!-- TicTacToe (online via Firebase) -->
  <div id="tic" class="card" style="display:none">
    <h2>ØªÙŠÙƒ-ØªØ§Ùƒ-ØªÙˆ (Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†)</h2>
    <div class="small">Ø§Ù†Ø´Ø¦ Ø£Ùˆ Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ ØºØ±ÙØ© Ù…Ø´ØªØ±ÙƒØ©: Ø´Ø§Ø±Ùƒ Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ© Ù…Ø¹ ØµØ¯ÙŠÙ‚Ùƒ.</div>
    <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
      <input id="roomId" placeholder="Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ© (Ù…Ø«Ø§Ù„: room123)" />
      <button id="createRoom">Ø¥Ù†Ø´Ø§Ø¡/Ø¯Ø®ÙˆÙ„</button>
      <button id="leaveRoom">Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØºØ±ÙØ©</button>
    </div>
    <div style="margin-top:10px">
      <div>Ø§Ù„Ø­Ø§Ù„Ø©: <span id="status">ØºÙŠØ± Ù…ØªØµÙ„</span></div>
      <div style="margin-top:10px" class="grid" id="board"></div>
      <div style="margin-top:10px">
        <div id="turnInfo"></div>
      </div>
    </div>
  </div>

  <!-- Firebase SDK (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
  // ======= CONFIG: Ø¶Ø¹ Ù‡Ù†Ø§ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase (ØªØ£Ø®Ø°Ù‡Ø§ Ù…Ù† console.firebase.google.com) =======
  const firebaseConfig = {
    // REPLACE WITH YOUR FIREBASE CONFIG
    // example:
    // apiKey: "xxxx",
    // authDomain: "project-id.firebaseapp.com",
    // databaseURL: "https://project-id-default-rtdb.firebaseio.com",
    // projectId: "project-id",
  };
  // ======= INIT =======
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  // ---- UI switch
  document.getElementById('show-memory').onclick = ()=>{document.getElementById('memory').style.display='block';document.getElementById('tic').style.display='none'}
  document.getElementById('show-tic').onclick = ()=>{document.getElementById('memory').style.display='none';document.getElementById('tic').style.display='block'}

  // ================= Memory (local) =================
  const symbols = ['ğŸ','ğŸŒ','ğŸ‡','ğŸ’','ğŸ‹','ğŸ‰','ğŸ¥','ğŸ']; // 8 Ø²ÙˆØ¬ => 16 Ù…Ø±Ø¨Ø¹Ø§Øª
  let memBoard = [];
  let first=null, second=null;
  function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]} return a}
  function initMemory(){
    const arr = shuffle(symbols.concat(symbols));
    memBoard = arr.map((s,i)=>({sym:s,flipped:false,done:false,id:i}));
    renderMemory();
  }
  function renderMemory(){
    const el = document.getElementById('memoryBoard'); el.innerHTML='';
    memBoard.forEach(tile=>{
      const d=document.createElement('div'); d.className='tile '+(tile.flipped||tile.done?'':'hidden');
      d.textContent = (tile.flipped||tile.done)?tile.sym:'';
      d.onclick = ()=> {
        if(tile.flipped||tile.done) return;
        if(first===null){tile.flipped=true; first=tile; renderMemory(); return}
        if(second===null){tile.flipped=true; second=tile; renderMemory();
          // check
          if(first.sym===second.sym){first.done=true; second.done=true; first=null; second=null}
          else { setTimeout(()=>{ first.flipped=false; second.flipped=false; first=null; second=null; renderMemory(); },800) }
        }
      };
      el.appendChild(d);
    });
  }
  document.getElementById('resetMemory').onclick = initMemory;
  initMemory();

  // ================= TicTacToe (online via Firebase Realtime DB) =================
  const boardEl = document.getElementById('board');
  let mySymbol = null; // 'X' or 'O'
  let roomRef = null;
  let localRoomId = null;
  function createBoardUI(){
    boardEl.innerHTML='';
    for(let i=0;i<9;i++){
      const c=document.createElement('div'); c.className='cell'; c.id='cell'+i; c.textContent='';
      c.onclick = ()=> tryMove(i);
      boardEl.appendChild(c);
    }
  }
  createBoardUI();

  function setStatus(t){document.getElementById('status').textContent = t}
  function setTurnInfo(t){document.getElementById('turnInfo').textContent = t}

  // create or join room
  document.getElementById('createRoom').onclick = ()=>{
    const id = (document.getElementById('roomId').value||'').trim();
    if(!id){alert('Ø¶Ø¹ Ø±Ù…Ø² ØºØ±ÙØ©'); return}
    joinRoom(id);
  }
  document.getElementById('leaveRoom').onclick = ()=>{
    if(roomRef && localRoomId){
      roomRef.off(); roomRef=null; localRoomId=null; mySymbol=null; setStatus('ØºÙŠØ± Ù…ØªØµÙ„'); setTurnInfo(''); createBoardUI();
    }
  }

  async function joinRoom(id){
    localRoomId = id;
    roomRef = database.ref('rooms/' + id);
    setStatus('Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…...');
    // read once to see room state
    const snap = await roomRef.once('value');
    let data = snap.val();
    if(!data){
      // create room
      const newRoom = {board:Array(9).fill(''),turn:'X',players:{X:true},winner:''};
      await roomRef.set(newRoom);
      mySymbol = 'X';
      setStatus('Ø£Ù†Ø´Ø£Øª Ø§Ù„ØºØ±ÙØ© â€” Ø£Ù†Øª X');
    } else {
      // join as O if available
      if(!data.players || !data.players.O){
        await roomRef.child('players/O').set(true);
        mySymbol = 'O';
        setStatus('Ø§Ù†Ø¶Ù…Ù…Øª Ù„Ù„ØºØ±ÙØ© â€” Ø£Ù†Øª O');
      } else {
        alert('Ø§Ù„Ù‚Ø§Ø¹Ø© Ù…Ù…ØªÙ„Ø¦Ø© (2 Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙÙ‚Ø·). Ø§Ø®ØªØ± Ø±Ù…Ø² Ø¢Ø®Ø± Ø£Ùˆ Ø£Ù†Ø´Ø¦ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©.');
        roomRef.off(); roomRef=null; localRoomId=null; return;
      }
    }
    // start listening Ù„Ù„Ø§Ø®ØªÙ„Ø§ÙØ§Øª
    roomRef.on('value', snap => {
      const val = snap.val();
      if(!val) return;
      renderGameState(val);
    });
  }

  function renderGameState(state){
    // update board UI
    state.board.forEach((v,i)=>{
      const el = document.getElementById('cell'+i);
      if(el) el.textContent = v;
    });
    if(state.winner){
      setTurnInfo('Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø© â€” Ø§Ù„ÙØ§Ø¦Ø²: ' + state.winner);
    } else {
      setTurnInfo('Ø¯ÙˆØ±: ' + state.turn + (mySymbol?(' â€” Ø£Ù†Øª: '+mySymbol):''));
    }
  }

  async function tryMove(i){
    if(!roomRef){alert('Ø§Ù†Ø¶Ù… Ù„ØºØ±ÙØ© Ø£ÙˆÙ„Ø§Ù‹'); return}
    const snap = await roomRef.once('value');
    const room = snap.val();
    if(room.winner) return alert('Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù†ØªÙ‡Øª');
    if(room.board[i]) return; // Ù…Ø´ ÙØ§Ø¶ÙŠ
    if(room.turn !== mySymbol) return alert('Ù„ÙŠØ³Øª Ø­Ø±ÙƒØªÙƒ');
    // perform move
    room.board[i] = mySymbol;
    // check win
    const win = checkWinner(room.board);
    if(win){
      room.winner = mySymbol;
      room.turn = '';
    } else {
      room.turn = (room.turn === 'X') ? 'O' : 'X';
    }
    await roomRef.set(room);
  }

  function checkWinner(b){
    const lines = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];
    for(const [a,c,d] of lines){
      if(b[a] && b[a]===b[c] && b[a]===b[d]) return b[a];
    }
    return null;
  }

  // Cleanup when closed
  window.addEventListener('beforeunload', ()=>{
    if(localRoomId && mySymbol==='O'){
      // if O leaves, remove player O flag (not necessary but polite)
      database.ref('rooms/'+localRoomId+'/players/O').remove();
    }
  });
  </script>
</body>
</html>
